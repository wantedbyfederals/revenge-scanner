<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>REVENGE | Advanced Threat Hunter</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap');

:root {
--bg-deep: #08080a;
--panel-bg: #0d0d10;
--accent: #ff4141;
--glass-border: rgba(255, 255, 255, 0.05);
}

body {
background: var(--bg-deep);
color: #e2e8f0;
font-family: 'Inter', sans-serif;
overflow: hidden;
height: 100vh;
}

.sidebar {
background: #050507;
border-right: 1px solid var(--glass-border);
width: 280px;
}

.glass-card {
background: var(--panel-bg);
border: 1px solid var(--glass-border);
border-radius: 12px;
}

.pin-card {
cursor: pointer;
transition: all 0.3s ease;
background: linear-gradient(145deg, #121217 0%, #0a0a0c 100%);
border: 1px solid var(--glass-border);
position: relative;
overflow: hidden;
border-left: 4px solid var(--accent);
}

.pin-card:hover {
border-color: var(--accent);
transform: translateY(-3px);
box-shadow: 0 10px 20px rgba(0,0,0,0.4);
}

/* FINDINGS MÁS GRANDES */
.finding-entry {
background: #111317;
border-left: 3px solid var(--accent);
border-radius: 8px;
padding: 20px;
display: flex;
flex-direction: column;
justify-content: space-between;
box-shadow: 0 6px 25px rgba(0,0,0,0.35);
min-height: 140px;
transition: all 0.2s ease;
}

.finding-entry:hover {
transform: translateY(-3px);
border-color: var(--accent);
}

/* FONDO MÁS CLARO */
#findings-container {
height: 600px;
max-height: 600px;
overflow-y: auto;
padding: 20px;
padding-right: 10px;
border: 1px solid var(--glass-border);
border-radius: 12px;
background: var(--panel-bg);
}

#findings-container::-webkit-scrollbar {
width: 6px;
}
#findings-container::-webkit-scrollbar-thumb {
background: var(--accent);
border-radius: 10px;
}
#findings-container::-webkit-scrollbar-track {
background: #0a0a0d;
}

.hw-label {
font-family: 'JetBrains Mono', monospace;
color: #64748b;
font-size: 10px;
text-transform: uppercase;
letter-spacing: 1px;
display: flex;
align-items: center;
gap: 8px;
}

.hw-value {
color: #fff;
font-weight: 700;
font-size: 13px;
margin-top: 3px;
}

.cat-item {
display: flex;
align-items: center;
justify-content: space-between;
padding: 12px 16px;
border-radius: 8px;
background: rgba(255,255,255,0.02);
transition: all 0.2s;
cursor: pointer;
border: 1px solid transparent;
margin-bottom: 8px;
}

.cat-item:hover { background: rgba(255,255,255,0.05); }
.cat-item.active {
background: rgba(255,65,65,0.05);
border-color: rgba(255,65,65,0.2);
}

.cat-name {
color: #ffffff;
font-weight: 700;
font-size: 12px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.cat-badge {
font-family: 'JetBrains Mono', monospace;
font-size: 11px;
font-weight: 900;
padding: 2px 8px;
border-radius: 4px;
background: rgba(0,0,0,0.4);
}

.hidden { display: none !important; }
</style>
</head>

<body class="flex">

<!-- AUTH / SIDEBAR / MAIN SIN CAMBIOS -->
<!-- (Se mantiene exactamente igual que tu versión original) -->

<script>
const DB_URL = "https://revengescanner-default-rtdb.firebaseio.com";
const WEBHOOK = "https://discord.com/api/webhooks/1476109273569431725/IvdnhbroUp8VRnsU29xb9lDu1Oea5ba_D6573DZOuZKAYY4nodqdZGLLz69wx0KZA_py";

let activeOTP = null;
let openPin = null;

/* ================= NUEVO RENDER FINDINGS ================= */

function renderFindings(findings, filter) {
const container = document.getElementById('findings-grid');

const filtered = (findings || []).filter(f => {
if (filter === 'Critical') return !f.category || f.category === 'Critical';
return f.category === filter;
});

if (filtered.length === 0) {
container.innerHTML = `
<div class="col-span-full py-24 flex flex-col items-center justify-center opacity-20 border-2 border-dashed border-white/5 rounded-2xl">
<i class="fa fa-folder-open text-6xl mb-4"></i>
<span class="text-xl font-black uppercase italic tracking-[0.3em]">No records found</span>
</div>`;
return;
}

container.innerHTML = filtered.map(f => `
<div class="finding-entry">
<div class="flex justify-between items-start mb-3">
<h4 class="text-[15px] font-black uppercase tracking-tight text-white">${f.title}</h4>
<span class="text-[11px] bg-red-600/20 text-red-500 px-2 py-1 rounded font-black uppercase border border-red-500/20">
${f.category || 'CRITICAL'}
</span>
</div>
<p class="text-[13px] text-gray-400 font-mono italic">
${f.detail}
</p>
</div>
`).join('');
}

/* ================= OPEN REPORT MODIFICADO ================= */

async function openReport(pin, push = true) {
openPin = pin;
if (push) updateRoute(pin);

const res = await fetch(`${DB_URL}/pins/${pin}.json`);
const data = await res.json();
if (!data) { abortSession(); return; }

const specs = data.specs || {};
const findings = data.findings?.findings || [];

const counts = {
critical: findings.filter(f => !f.category || f.category === 'Critical').length,
warning: findings.filter(f => f.category === 'Warning').length,
suspicious: findings.filter(f => f.category === 'Suspicious').length,
antivirus: findings.filter(f => f.category === 'Antivirus').length,
invalid: findings.filter(f => f.category === 'Invalid Signature').length,
usb: findings.filter(f => f.category === 'USB Files').length
};

document.getElementById('report-content').innerHTML = `
<div class="col-span-12 lg:col-span-4 space-y-6">
<div class="glass-card p-6 border border-white/5">
<div class="hw-label mb-6 text-gray-400 font-black tracking-widest">SECURITY CLASSIFICATIONS</div>
<div id="cat-list" class="space-y-2">

<div onclick="renderFindings(${JSON.stringify(findings)}, 'Critical')" class="cat-item active">
<div class="flex items-center gap-3">
<i class="fa fa-biohazard text-red-500"></i>
<span class="cat-name">Critical</span>
</div>
<span class="cat-badge text-red-500">${counts.critical}</span>
</div>

<div onclick="renderFindings(${JSON.stringify(findings)}, 'Warning')" class="cat-item">
<div class="flex items-center gap-3">
<i class="fa fa-triangle-exclamation text-orange-500"></i>
<span class="cat-name">Warning</span>
</div>
<span class="cat-badge text-orange-500">${counts.warning}</span>
</div>

<div onclick="renderFindings(${JSON.stringify(findings)}, 'Suspicious')" class="cat-item">
<div class="flex items-center gap-3">
<i class="fa fa-user-secret text-purple-500"></i>
<span class="cat-name">Suspicious</span>
</div>
<span class="cat-badge text-purple-500">${counts.suspicious}</span>
</div>

<div onclick="renderFindings(${JSON.stringify(findings)}, 'Antivirus')" class="cat-item">
<div class="flex items-center gap-3">
<i class="fa fa-shield-virus text-green-500"></i>
<span class="cat-name">Antivirus</span>
</div>
<span class="cat-badge text-green-500">${counts.antivirus}</span>
</div>

<div onclick="renderFindings(${JSON.stringify(findings)}, 'Invalid Signature')" class="cat-item">
<div class="flex items-center gap-3">
<i class="fa fa-file-circle-xmark text-pink-500"></i>
<span class="cat-name">Invalid Signature</span>
</div>
<span class="cat-badge text-pink-500">${counts.invalid}</span>
</div>

<div onclick="renderFindings(${JSON.stringify(findings)}, 'USB Files')" class="cat-item">
<div class="flex items-center gap-3">
<i class="fa fa-usb text-cyan-500"></i>
<span class="cat-name">USB Files</span>
</div>
<span class="cat-badge text-cyan-500">${counts.usb}</span>
</div>

</div>
</div>
</div>

<div class="col-span-12 lg:col-span-8">
<h3 class="text-xl font-black uppercase italic mb-8 flex items-center gap-3 text-white">
<span class="w-8 h-[2px] bg-red-600"></span> Live Analysis Findings
</h3>
<div id="findings-container">
<div id="findings-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</div>
</div>
`;

renderFindings(findings, 'Critical');

document.getElementById('view-list').classList.add('hidden');
document.getElementById('view-detail').classList.remove('hidden');

document.querySelectorAll('.cat-item').forEach(item => {
item.addEventListener('click', function() {
document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
this.classList.add('active');
});
});
}
</script>

</body>
</html>
